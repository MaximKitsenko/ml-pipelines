syntax = "proto3";

import "google/protobuf/timestamp.proto";


message ProjectCreated{
    string project_id = 1;
    string name = 2;
}

message DatasetCreated{
    string dataset_id = 1;
    string name = 2;
    string project_id = 3;
    DatasetMetadata metadata = 4;

    repeated string experts = 5;
}

message DatasetUpdated {
    string dataset_id = 1;
    string project_id = 2;
    DatasetMetadata metadata = 4;
}



message JobAdded {
    string job_id = 1;
    string job_name = 2;

    repeated string inputs = 3;
    repeated string outputs = 4;

    string project_id = 5;

    repeated string experts = 6;
}


message ExpertAdded {
    string expert_id = 1;
    string expert_name = 2;
}


enum FIELD_TYPES {
    FIELD_NONE = 0;
    FIELD_RECORD_COUNT = 1;
    FIELD_RAW_BYTES = 2;
    FIELD_ZIP_BYTES = 3;
    FIELD_SAMPLE = 4;
    FIELD_UPDATE_TIMESTAMP = 5;
    FIELD_FILE_COUNT = 6;
    FIELD_DATA_FORMAT = 7;
    FIELD_DESCRIPTION = 8;
    FIELD_LOCATION_ID = 9;
    FIELD_LOCATION_URI = 10;
}



// Sample storage format. Doesn't necessarily match
// actual data format which could be very cryptic
enum SAMPLE_KIND {
    TEXT = 0;
    TSV = 1;
    JSON = 2;
}


// if a field kind is set, then the corresponding property carries
// a new value (which could be null)
message DatasetMetadata {
    repeated FIELD_TYPES set_fields = 1;
    repeated FIELD_TYPES del_fields = 2;

    int64 record_count = 3;
    int64 file_count = 4;
    int64 raw_bytes = 5;
    int64 zip_bytes = 6;



    bytes sample_body = 7;
    SAMPLE_KIND sample_kind = 8;

    int64 update_timestamp = 9;

    string data_format = 10;
    string description = 11;
    string location_id = 12;
    string location_uri = 13;

}

enum Type {
    None = 0;
    Event_ProjectCreated = 1;
    Event_DatasetCreated = 2;
    Event_DatasetUpdated = 3;
    Event_ExpertAdded = 4;
    Event_JobAdded = 5;
}


message Event {
    bytes Body = 1;
    Type Type = 2;
}


